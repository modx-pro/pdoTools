!function(t,e,i,s){"use strict";var a="pdoPage",n={wrapper:"#pdopage",rows:"#pdopage .row",pagination:"#pdopage .pagination",link:"#pdopage .pagination a",more:"#pdopage .btn-more",pdoTitle:"#pdopage .title",moreTpl:'<button class="btn btn-default btn-more">Load more</button>',waitAnimation:'<div class="wait-wrapper"><div class="wait"></div></div>',mode:"scroll",pageVarKey:"page",pageLimit:12,assetsUrl:"/assets/components/pdotools/",scrollTop:!0};function o(i,s){this.element=i,this.settings=t.extend({},n,s),this._defaults=n,this._name=a,this.key=this.settings.pageVarKey,this.wrapper=t(this.settings.wrapper),this.mode=this.settings.mode,this.reached=!1,this.history=this.settings.history,this.oldBrowser=!(e.history&&history.pushState),this.init()}t.extend(o.prototype,{init:function(){var e=this;if(null==this.page){var i=this.hashGet(),s=null==i[this.key]?1:i[this.key];this.page=Number(s)}switch(this.mode){case"default":this.initDefault();break;case"scroll":case"button":if(this.history){if(void 0===jQuery().sticky)return void t.getScript(this.settings.assetsUrl+"js/lib/jquery.sticky.js",function(){e.init(e.settings)});this.stickyPagination()}else t(this.settings.pagination).hide();"button"==this.mode?this.initButton():this.initScroll()}},initDefault:function(){var s=this;t(i).on("click",this.settings.link,function(e){e.preventDefault();var i=t(this).prop("href"),a=i.match(new RegExp(s.key+"=(\\d+)")),n=a?a[1]:1;s.page!=n&&(s.history&&s.hashAdd(s.key,n),s.loadPage(i))}),this.history&&(t(e).on("popstate",function(t){t.originalEvent.state&&t.originalEvent.state.pdoPage&&s.loadPage(t.originalEvent.state.pdoPage)}),history.replaceState({pdoPage:e.location.href},""))},initButton:function(){var e=this;t(this.settings.rows).after(this.settings.moreTpl);var s=!1;t(this.settings.link).each(function(){var i=t(this).prop("href").match(new RegExp(e.key+"=(\\d+)"));if((i?i[1]:1)>e.page)return s=!0,!1}),s||t(this.settings.more).hide(),t(i).on("click",this.settings.more,function(t){t.preventDefault(),e.addPage()})},initScroll:function(){var i=this,s=t(e);s.on("scroll",function(){!i.reached&&s.scrollTop()>i.wrapper.height()-s.height()&&(i.reached=!0,i.addPage())})},addPage:function(){var e=this,i=this.hashGet()[this.key]||e.page||1;t(this.settings.link).each(function(){var s=t(this).prop("href"),a=s.match(new RegExp(e.key+"=(\\d+)")),n=a?Number(a[1]):1;if(n>i)return e.history&&e.hashAdd(e.key,n),e.page=i,e.loadPage(s,"append"),!1})},loadPage:function(i,s){var a=this,n=t(this.settings.rows),o=t(this.settings.pagination),r=i.match(new RegExp(this.key+"=(\\d+)")),p=r?Number(r[1]):1;if(s||(s="replace"),this.page!=p||"force"==s){this.wrapper.trigger("beforeLoad",[this,this.settings]),"scroll"!=this.mode&&this.wrapper.css({opacity:.3}),this.page=p;var h=t(this.settings.waitAnimation);"append"==s?this.wrapper.find(n).append(h):this.wrapper.find(n).empty().append(h);var l=this.getUrlParameters(i);l[this.key]=this.page,t.get(e.location.pathname,l,function(e){e&&(a.wrapper.find(o).replaceWith(e.pagination),a.history||t(a.settings.pagination).hide(),"append"===s?(a.wrapper.find(n).append(e.output),"button"==a.mode?e.pages==e.page||0==e.pages?t(a.settings.more).hide():t(a.settings.more).show():"scroll"==a.mode&&(a.reached=!1),h.remove()):(a.wrapper.find(n).html(e.output),"force"===s&&(a.page=1,"button"==a.settings.mode&&(e.pages==e.page||0==e.pages?t(a.settings.more).hide():t(a.settings.more).show()),a.history&&a.hashSet(l))),a.wrapper.trigger("afterLoad",[a,a.settings,e]),"scroll"!=a.mode&&(a.wrapper.css({opacity:1}),"default"==a.mode&&a.settings.scrollTop&&t("html, body").animate({scrollTop:a.wrapper.position().top-50||0},0)),a.updateTitle(e))},"json")}},stickyPagination:function(){var e=t(this.settings.pagination);e.is(":visible")&&(e.sticky({wrapperClassName:"sticky-pagination",getWidthFrom:this.settings.pagination,responsiveWidth:!0}),this.wrapper.trigger("scroll"))},updateTitle:function(e){if("undefined"!=typeof pdoTitle){for(var i=t("title"),s=pdoTitle.separator||" / ",a=pdoTitle.tpl,n=[],o=i.text().split(s),r=new RegExp("^"+a.split(" ")[0]+" "),p=0;p<o.length;p++)1===p&&e.page&&e.page>1&&n.push(a.replace("{page}",e.page).replace("{pageCount}",e.pages)),o[p].match(r)||n.push(o[p]);i.text(n.join(s))}},getUrlParameters:function(t){var e={},i=t.indexOf("?");return-1!==i&&(e=this.deparam(t.substring(i+1))),e},deparam:function(e){var i,s,a=/^\d+$/,n=/([^\[\]]+)|(\[\])/g,o=function(t){return decodeURIComponent(t.replace(/\+/g," "))},r={};return e&&/([^?#]*)(#.*)?$/.test(e)&&(i=e.split("&"),t.each(i,function(t,e){var i=e.split("="),p=o(i.shift()),h=o(i.join("=")),l=r;if(p){for(var g=0,d=(i=p.match(n)).length-1;g<d;g++)l[i[g]]||(l[i[g]]=a.test(i[g+1])||"[]"===i[g+1]?[]:{}),l=l[i[g]];"[]"===(s=i.pop())?l.push(h):l[s]=h}})),r},hashGet:function(){var t,i,s={};if(this.oldBrowser){if((i=decodeURIComponent(e.location.hash.substr(1))).length)for(var a in i=i.split("/"))i.hasOwnProperty(a)&&(void 0===(t=i[a].split("="))[1]?s.anchor=t[0]:s[t[0]]=t[1])}else{var n=e.location.href.indexOf("?");i=-1!=n?decodeURIComponent(e.location.href.substr(n+1)):"",s=this.deparam(i)}return s},hashSet:function(t){var i="";for(var s in t)if(t.hasOwnProperty(s))if("object"!=typeof t[s])i+="&"+s+"="+t[s];else for(var a in t[s])t[s].hasOwnProperty(a)&&(!isNaN(parseFloat(a))&&isFinite(parseFloat(a))?i+="&"+s+"[]="+t[s][a]:i+="&"+s+"["+a+"]="+t[s][a]);this.oldBrowser?e.location.hash=i.substr(1):(0!==i.length&&(i="?"+i.substr(1)),e.history.pushState({pdoPage:e.location.pathname+i},"",e.location.pathname+i))},hashAdd:function(t,e){var i=this.hashGet();i[t]=e,this.hashSet(i)},hashRemove:function(t){var e=this.hashGet();delete e[t],this.hashSet(e)},hashClear:function(){this.hashSet({})}}),t.fn[a]=function(e){var i,s=arguments;return void 0===e||"object"==typeof e?this.each(function(){t.data(this,"plugin_"+a)||t.data(this,"plugin_"+a,new o(this,e))}):"string"==typeof e&&"_"!==e[0]&&"init"!==e?(this.each(function(){var n=t.data(this,"plugin_"+a);n instanceof o&&"function"==typeof n[e]&&(i=n[e].apply(n,Array.prototype.slice.call(s,1))),"destroy"===e&&t.data(this,"plugin_"+a,null)}),void 0!==i?i:this):void 0}}(jQuery,window,document);
